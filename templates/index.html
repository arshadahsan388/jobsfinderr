{% extends "base.html" %} {% block meta %}
  {% set meta_title = "Latest Government Jobs in Pakistan - July 2025" %}
  {% set meta_description = "Explore government jobs updated daily. Smart AI-powered job search for every city in Pakistan." %}
  {% set meta_keywords = "govt jobs, karachi jobs, lahore jobs, remote, AI jobs" %}
{% endblock %} {% block content %}


<!-- Beautiful Loading Animation -->
<div id="loader" class="loader">
  <div class="loader-text">JobsFinderr</div>
  
  <div class="loader-dots">
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
  </div>
  
  <div class="loader-progress">
    <div class="loader-progress-bar"></div>
  </div>
  
  <div class="loader-message">Loading amazing jobs for you...</div>
</div>

<script>
// Hide loader instantly if user is returning from detail page
(function() {
  const scrollPosition = localStorage.getItem('jobsScrollPosition');
  if (scrollPosition) {
    const loader = document.getElementById("loader");
    if (loader) {
      loader.style.display = "none";
      loader.style.visibility = "hidden";
      loader.style.opacity = "0";
    }
  }
})();
</script>

  <!-- Search Bar -->
  <div class="row justify-content-center mb-4">
    <div class="col-md-6">
      <input
        type="text"
        id="jobSearch"
        class="form-control"
        placeholder="🔍 Search jobs..."
        onkeyup="filterJobs()"
      />
    </div>
  </div>

  <!-- Job Cards -->
  <div class="row row-cols-1 row-cols-md-3 g-4" id="jobContainer">
    {% for job in jobs %}
    <div class="col job-item">
      <div class="card h-100 position-relative clickable-card" onclick="navigateToJob('{{ job.id }}')">
        <div class="card-body">
          <h5 class="card-title title">{{ job.title }}</h5>
          {% if job.images and job.images[0] %}
  <img src="{{ job.images[0] }}" alt="Job Image" class="img-fluid rounded mb-3" />
{% endif %}
          <p>
            <strong>Last Date:</strong>
            {{ job.details.get('Last Date for Apply', 'Not specified') }}
          </p>

          <p class="card-text">
            <strong>Education:</strong> {{ job.details.get('Education', 'Not
            specified') }}
          </p>

          <a
            href="{{ url_for('job_detail', job_id=job.id) }}"
            class="btn btn-primary mt-2"
            onclick="event.stopPropagation(); saveScrollPosition();"
            >Apply</a
          >
          
          {% if job.get('is_new') and job.get('added_at') %}
          <div class="time-badge mt-2" data-timestamp="{{ job.get('added_at') }}">
            <span class="time-text">Just added</span>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
<div class="text-center my-4">
  <img src="{{ url_for('static', filename='banner.png') }}" alt="JobsFinderr Banner" class="img-fluid rounded shadow" />
</div>
<script>
  function toggleDarkMode() {
    document.body.classList.toggle("dark-mode");

    // Save theme preference
    if (document.body.classList.contains("dark-mode")) {
      localStorage.setItem("theme", "dark");
    } else {
      localStorage.setItem("theme", "light");
    }
  }

  function filterJobs() {
    const input = document.getElementById("jobSearch").value.toLowerCase();
    const cards = document.querySelectorAll(".job-item");

    cards.forEach((card) => {
      const title =
        card.querySelector(".title")?.textContent.toLowerCase() || "";
      const desc = card.querySelector(".desc")?.textContent.toLowerCase() || "";

      if (title.includes(input) || desc.includes(input)) {
        card.style.display = "block";
      } else {
        card.style.display = "none";
      }
    });
  }

  function hideLoader() {
    const loader = document.getElementById("loader");
    
    // Instant hide - no delay
    loader.classList.add("hidden");
  }

  // Save scroll position when clicking on job
  function saveScrollPosition() {
    localStorage.setItem('jobsScrollPosition', window.scrollY);
  }

  // Navigate to job detail when card is clicked
  function navigateToJob(jobId) {
    saveScrollPosition();
    window.location.href = `/job/${jobId}`;
  }

  // Calculate time ago from timestamp
  function timeAgo(timestamp) {
    const now = new Date();
    const jobTime = new Date(timestamp);
    const diffMs = now - jobTime;
    const diffMinutes = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMinutes / 60);
    const diffDays = Math.floor(diffHours / 24);

    if (diffMinutes < 1) return "Just now";
    if (diffMinutes < 60) return `${diffMinutes} min ago`;
    if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
    if (diffDays < 7) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
    return "Recently added";
  }

  // Update time badges
  function updateTimeBadges() {
    const timeBadges = document.querySelectorAll('.time-badge');
    timeBadges.forEach(badge => {
      const timestamp = badge.getAttribute('data-timestamp');
      if (timestamp) {
        const timeText = badge.querySelector('.time-text');
        if (timeText) {
          timeText.textContent = timeAgo(timestamp);
        }
      }
    });
  }

  // Restore scroll position when returning from job detail
  function restoreScrollPosition() {
    // Check if there's a scroll position in localStorage
    const scrollPosition = localStorage.getItem('jobsScrollPosition');
    if (scrollPosition) {
      setTimeout(() => {
        window.scrollTo(0, parseInt(scrollPosition));
        localStorage.removeItem('jobsScrollPosition'); // Remove after use
      }, 100); // Small delay to ensure page is fully loaded
    }
  }

  // Apply saved theme on load
  window.addEventListener("load", function () {
  const savedTheme = localStorage.getItem("theme");
  if (savedTheme === "dark") {
    document.body.classList.add("dark-mode");
  } else {
    document.body.classList.remove("dark-mode"); // 🧠 This line fixes it
  }

  // Check if user is returning from job detail page
  const scrollPosition = localStorage.getItem('jobsScrollPosition');
  if (scrollPosition) {
    // User is returning from detail page - instantly hide loader
    const loader = document.getElementById("loader");
    if (loader) {
      loader.style.display = "none"; // Instant hide - no animation
    }
    restoreScrollPosition();
  } else {
    // First time visit - show loading for only 1 second
    setTimeout(() => {
      hideLoader();
    }, 1000);
  }
  
  // Update time badges on load
  updateTimeBadges();
  
  // Update time badges every minute
  setInterval(updateTimeBadges, 60000);
});

// Also check on DOM ready for faster response
document.addEventListener("DOMContentLoaded", function() {
  const scrollPosition = localStorage.getItem('jobsScrollPosition');
  if (scrollPosition) {
    // User is returning - hide loader immediately
    const loader = document.getElementById("loader");
    if (loader) {
      loader.style.display = "none";
      loader.style.visibility = "hidden";
      loader.style.opacity = "0";
    }
  }
});

</script>

{% endblock %}
